<% layout('layouts/post-show-layout') -%>


<h1><%= post.title %></h1>
<div>Price: <%= post.price %></div>
<div><%= post.description %></div>
<div><%= post.location %></div>
<div>
	<% post.images.forEach(function(image) { %>
	<img src="<%= image.url %>" alt="Surf board image" width="200px">
	<% }); %>
</div>
<div id='map'></div>
<div>
	<a href="/posts/<%= post.id %>/edit">
		<button>Edit</button>
	</a>
</div>
<div>
	<form action="/posts/<%= post.id %>?_method=DELETE" method="POST">
		<input type="submit" value="Delete">
	</form>
</div>

<script>
	var post = <%- JSON.stringify(post) %>;
	mapboxgl.accessToken = 'pk.eyJ1IjoicHJhdmVlbmRiIiwiYSI6ImNqd2V6cmV6OTBtdmozeXBiczR4emxkMnUifQ.NOEa5dpBgs3PPvIZRV2VjA';
	
	var map = new mapboxgl.Map({
	  container: 'map',
	  style: 'mapbox://styles/mapbox/light-v9',
	  center: post.coordinates,
	  zoom: 5
	});
	
	// create a HTML element for our post location/marker
	var el = document.createElement('div');
	el.className = 'marker';
	
	// make a marker for our location and add to the map
	new mapboxgl.Marker(el)
	.setLngLat(post.coordinates)
	.setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
	.setHTML('<h3>' + post.title + '</h3><p>' + post.location + '</p>'))
	.addTo(map);
</script>	